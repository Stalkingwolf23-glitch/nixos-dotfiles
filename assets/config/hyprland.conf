# Monitor Setup
monitor=DP-4, 2560x1440@120, 0x0, 1, bitdepth, 10
monitor=HDMI-A-2, 1920x1080@60, auto-right, 1

# Define primary applications
$terminal = foot
$fileManager = thunar
$browser = zen-beta
$editor = code
$menu = fuzzel

# Autostart essential processes
exec-once = uwsm app hyprpaper
exec-once = uwsm app mako
exec-once = uwsm app waybar
exec-once = wl-paste --watch cliphist store
exec-once = uwsm app hypridle
exec-once = uwsm app nm-applet --no-agent
exec-once = uwsm app blueman-applet
exec-once = [workspace special:term silent] foot -a scratch -e tmux new-session -A -s "scratch"
exec-once = steam -silent

# unscale XWayland
xwayland {
  force_zero_scaling = true
}

# Special Workspace (Scratchpad)
workspace = s[true],gapsin:3,gapsout:79 150 79 150 
bind = , F12, togglespecialworkspace, term


## QT
env = QT_QPA_PLATFORM,wayland;xcb
env = QT_QPA_PLATFORMTHEME,qt6ct
env = QT_WAYLAND_DISABLE_WINDOWDECORATION,1
env = QT_AUTO_SCREEN_SCALE_FACTOR,1
env = QT_STYLE_OVERRIDE,kvantum

## Toolkit Backend Variables
env = GDK_BACKEND,wayland,x11,*
env = SDL_VIDEODRIVER,wayland
env = CLUTTER_BACKEND,wayland

## Mouse Stuff
env = GDK_SCALE,1.25
env = XCURSOR_THEME,catppuccin-cursors.mochaDark
env = XCURSOR_SIZE,24

## XDG Specifications
env = XDG_CURRENT_DESKTOP,Hyprland
env = XDG_SESSION_TYPE,wayland
env = XDG_SESSION_DESKTOP,Hyprland
env = XDG_DOWNLOAD_DIR,$HOME/Downloads
env = XDG_DOCUMENTS_DIR,$HOME/Documents
env = XDG_PICTURES_DIR,$HOME/Pictures
env = XDG_SCREENSHOTS_DIR,$HOME/Pictures/Screenshots

## Nvidia Junk
env = LIBVA_DRIVER_NAME,nvidia
env = __GLX_VENDOR_LIBRARY_NAME,nvidia
env = __GL_VRR_ALLOWED,1
env = WLR_NO_HARDWARE_CURSORS,1
env = WLR_DRM_NO_ATOMIC,1

# Look and Feel
general { 
    gaps_in = 5
    gaps_out = 5
    border_size = 2
    col.active_border = rgb(89b4fa) rgb(cba6f7) 45deg
    col.inactive_border = rgb(24273A)
    resize_on_border = true
    allow_tearing = false
    layout = dwindle
}

decoration {
    rounding = 7
    dim_modal = true
    blur {
        enabled = true
        size = 5
        passes = 4
        new_optimizations = true
        xray = true
        popups = true
    }
    shadow {
        enabled = true
        range = 4
        render_power = 3
        color = rgba(1a1a1aee)
    }
}

animations {
    enabled = yes
    # Curves
    bezier = expressiveFastSpatial, 0.42, 1.67, 0.21, 0.90
    bezier = expressiveSlowSpatial, 0.39, 1.29, 0.35, 0.98
    bezier = expressiveDefaultSpatial, 0.38, 1.21, 0.22, 1.00
    bezier = emphasizedDecel, 0.05, 0.7, 0.1, 1
    bezier = emphasizedAccel, 0.3, 0, 0.8, 0.15
    bezier = standardDecel, 0, 0, 0, 1
    bezier = menu_decel, 0.1, 1, 0, 1
    bezier = menu_accel, 0.52, 0.03, 0.72, 0.08
    # Configs
    # windows
    animation = windowsIn, 1, 3, emphasizedDecel, popin 80%
    animation = windowsOut, 1, 2, emphasizedDecel, popin 90%
    animation = windowsMove, 1, 3, emphasizedDecel, slide
    animation = border, 1, 10, emphasizedDecel
    # layers
    animation = layersIn, 1, 2.7, emphasizedDecel, popin 93%
    animation = layersOut, 1, 2.4, menu_accel, popin 94%
    # fade
    animation = fadeLayersIn, 1, 0.5, menu_decel
    animation = fadeLayersOut, 1, 2.7, menu_accel
    # workspaces
    animation = workspaces, 1, 7, menu_decel, slide    
    # special workspaces
    animation = specialWorkspace, 1, 4, default, slidevert 
}

# Dwindle
dwindle {
    pseudotile = yes
    preserve_split = yes
    force_split = 2
}

# Input
input {
    kb_layout = us
    follow_mouse = 1
    sensitivity = 0

    touchpad {
        natural_scroll = true
    }
}

# Misc
misc {
    force_default_wallpaper = 0
    disable_hyprland_logo = true
    disable_splash_rendering = true
    disable_hyprland_qtutils_check = true
    middle_click_paste = false
    swallow_regex = (foot|kitty|allacritty|Alacritty)
    new_window_takes_over_fullscreen = 2
    vrr = 1
}

# Window Rules
# Floating
windowrulev2 = noborder, initialclass:^(zen-beta)$
windowrulev2 = center, title:^(Open File)(.*)$
windowrulev2 = float, title:^(Open File)(.*)$
windowrulev2 = center, title:^(Select a File)(.*)$
windowrulev2 = float, title:^(Select a File)(.*)$
windowrulev2 = center, title:^(Choose wallpaper)(.*)$
windowrulev2 = float, title:^(Choose wallpaper)(.*)$
windowrulev2 = size 60% 65%, title:^(Choose wallpaper)(.*)$
windowrulev2 = center, title:^(Open Folder)(.*)$
windowrulev2 = float, title:^(Open Folder)(.*)$
windowrulev2 = center, title:^(Save As)(.*)$
windowrulev2 = float, title:^(Save As)(.*)$
windowrulev2 = center, title:^(Library)(.*)$
windowrulev2 = float, title:^(Library)(.*)$
windowrulev2 = center, title:^(File Upload)(.*)$
windowrulev2 = float, title:^(File Upload)(.*)$
windowrulev2 = center, title:^(.*)(wants to save)$
windowrulev2 = float, title:^(.*)(wants to save)$
windowrulev2 = center, title:^(.*)(wants to open)$
windowrulev2 = float, title:^(.*)(wants to open)$
windowrulev2 = float, title:&(.*)(Rename)$
windowrulev2 = float, class:^(pavucontrol)$
windowrulev2 = size 45%, class:^(pavucontrol)$
windowrulev2 = center, class:^(pavucontrol)$
windowrulev2 = float, class:^(org.pulseaudio.pavucontrol)$
windowrulev2 = size 45%, class:^(org.pulseaudio.pavucontrol)$
windowrulev2 = center, class:^(org.pulseaudio.pavucontrol)$

# Tiling
windowrulev2 = tile, class:^dev\.warp\.Warp$

# Picture-in-Picture
windowrulev2 = float, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrulev2 = keepaspectratio, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrulev2 = move 73% 72%, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$ 
windowrulev2 = size 25%, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrulev2 = float, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$
windowrulev2 = pin, title:^([Pp]icture[-\s]?[Ii]n[-\s]?[Pp]icture)(.*)$

# Tearing
windowrulev2 = immediate, title:.*\.exe
windowrulev2 = immediate, class:^(steam_app).*

# No shadow for tiled windows (matches windows that are not floating).
windowrulev2 = noshadow, floating:0

# ######## Layer rules ########
layerrule = xray 1, .*
# layerrule = noanim, .*
layerrule = noanim, walker
layerrule = noanim, selection
layerrule = noanim, overview
layerrule = noanim, anyrun
layerrule = noanim, indicator.*
layerrule = noanim, osk
layerrule = noanim, hyprpicker

layerrule = noanim, noanim
layerrule = blur, gtk-layer-shell
layerrule = ignorezero, gtk-layer-shell
layerrule = blur, launcher
layerrule = ignorealpha 0.5, launcher
layerrule = blur, notifications
layerrule = ignorealpha 0.69, notifications
layerrule = blur, logout_dialog # wlogout

# Launchers need to be FAST
layerrule = noanim, gtk4-layer-shell

# Keybinds
$mainMod = SUPER

bind = $mainMod, T, exec, $terminal
bind = $mainMod, B, exec, $browser
bind = $mainMod, C, exec, $editor
bind = $mainMod, A, exec, $menu
bind = $mainMod, Q, killactive,
bind = $mainMod, M, exec, loginctl kill-session $XDG_SESSION_ID
bind = $mainMod, L, exec, hyprlock
bind = $mainMod, ESCAPE, exec, wlogout
bind = $mainMod, F, exec, $fileManager
bind = $mainMod, W, togglefloating,
bind = $mainMod, P, pseudo, # dwindle
bind = $mainMod, E, togglesplit, #dwindle

# Workspace change
bind = $mainMod, 1, split:workspace, 1
bind = $mainMod, 2, split:workspace, 2
bind = $mainMod, 3, split:workspace, 3
bind = $mainMod, 4, split:workspace, 4
bind = $mainMod, 5, split:workspace, 5
bind = $mainMod, TAB, split:workspace, previous
# bind = $mainMod, RETURN, split:swapactiveworkspaces current +1

bind = $mainMod, mouse_down, workspace, e+1
bind = $mainMod, mouse_up, workspace, e-1
bind = $mainMod, period, split:workspace, e+1
bind = $mainMod, comma, split:workspace, e-1

# Move focus with mainMod + arrow keys
bind = $mainMod, left, movefocus, l
bind = $mainMod, right, movefocus, r
bind = $mainMod, up, movefocus, u
bind = $mainMod, down, movefocus, d

# Move active window to a workspace with mainmainMod + SHIFT + [0-9]
bind = $mainMod SHIFT, 1, split:movetoworkspace, 1
bind = $mainMod SHIFT, 2, split:movetoworkspace, 2
bind = $mainMod SHIFT, 3, split:movetoworkspace, 3
bind = $mainMod SHIFT, 4, split:movetoworkspace, 4
bind = $mainMod SHIFT, 5, split:movetoworkspace, 5
bind = $mainMod SHIFT, 6, split:movetoworkspace, 6
bind = $mainMod SHIFT, 7, split:movetoworkspace, 7
bind = $mainMod SHIFT, 8, split:movetoworkspace, 8
bind = $mainMod SHIFT, 9, split:movetoworkspace, 9
bind = $mainMod SHIFT, 0, split:movetoworkspace, 10

# Move active window to other monitor
bind = $mainMod SHIFT, L, movewindow, mon:+1

# Move focus to other monitor
bind = $mainMod, code:49, focusmonitor, +1

# Move/resize windows with mainMod + LMB/RMB and dragging
bindm = $mainMod, mouse:272, movewindow
bindm = $mainMod, mouse:273, resizewindow

# Move/resize windows + Mouse
bindm = $mainMod, Z, movewindow
bindm = $mainMod, X, resizewindow

# Resize windows
binde = $mainMod+Shift, Right, resizeactive, 30 0
binde = $mainMod+Shift, Left, resizeactive, -30 0
binde = $mainMod+Shift, Up, resizeactive, 0 -30
binde = $mainMod+Shift, Down, resizeactive, 0 30

# Volume and Media Control
$volumeNotif = volume=$(pamixer --get-volume) && isMuted=$(pamixer --get-mute) && notify-send -h string:x-mako-stack-tag:vol -t 700 $([[ "$isMuted" == "false" ]] && echo "-h int:value:$volume" || echo "-h int:value:0") "$([[ "$isMuted" == "true" ]] && echo '               󰖁' || echo '               󰕾')  ${volume}%"
$micNotif = notify-send -h string:x-mako-stack-tag:mute -t 1000 "$([[ \"$(pamixer --default-source --get-mute)\" == \"true\" ]] && echo '               󰍭  Muted' || echo '             󰍬  Unmuted')"

# Fn keys
bind = , XF86MonBrightnessUp, exec, brightnessctl -q s +10% # Increase brightness by 10%
bind = , XF86MonBrightnessDown, exec, brightnessctl -q s 10%- # Reduce brightness by 10%
bind = , XF86AudioRaiseVolume, exec, pamixer -i 5 # Increase volume by 5%
bind = , XF86AudioLowerVolume, exec, pamixer -d 5 # Decrease volume by 5%
bind = , XF86AudioMute, exec, pamixer -t # Toggle mute
bind = , XF86AudioPlay, exec, playerctl play-pause # Audio play pause
bind = , XF86AudioPause, exec, playerctl pause # Audio pause
bind = , , exec, playerctl next # Audio next
bind = , XF86AudioPrev, exec, playerctl previous # Audio previous
bind = , XF86AudioMicMute, exec, pactl set-source-mute @DEFAULT_SOURCE@ toggle # Toggle microphone
bind = , XF86Calculator, exec, qalculate-gtk # Open calculator
bind = , XF86Lock, exec, hyprlock # Open screenlock
bind = , XF86Tools, exec, alacritty --class dotfiles-floating -e ~/dotfiles/apps/ML4W_Dotfiles_Settings-x86_64.AppImage # Open ML4W Dotfiles Settings app

# Media Shortcuts
bind = CTRL+SHIFT, SPACE, exec, playerctl play-pause
bind = CTRL+SHIFT, Left, exec, playerctl previous
bind = CTRL+SHIFT, Right, exec, playerctl next
bind = CTRL+SHIFT, Up, exec, pamixer -i 5
bind = CTRL+SHIFT, Down, exec, pamixer -d 5

# Restart waybar
bind = Ctrl, Escape, exec, pkill waybar || uwsm app waybar # toggle waybar

# Clipboard
bind = SUPER, V, exec, cliphist list | fuzzel --dmenu | cliphist decode | wl-copy

# Screenshots
bind = , Print, exec, grimblast copysave screen --notify
bind = $mainMod, Print, exec, grimblast copysave active --notify
bind = $mainMod Shift, S, exec, grimblast copysave area --notify

plugin {
    dynamic-cursors {
        enabled = true
        mode = stretch
        threshold = 2
        rotate {
            length = 20
            offset = 0.0
        }

        tilt {
            limit = 3500
            function = negative_quadratic
        }
        shake {
            enabled = true
            nearest = true
            threshold = 6.0
            base = 4.0
            speed = 4.0
            influence = 1.0
            timeout = 2000
            effects = false
        }
    }

    hyprsplit {
        enabled = true
        num_workspaces = 5
    }

    xwaylandprimary {
        display = DP-4
    }
    
    # hyprexpo {
    #     enabled = true
    #     columns = 3
    #     gap_size = 5
    #     bg_col = rgb(000000)
    #     workspace_method = first 1 # [center/first] [workspace] e.g. first 1 or center m+1

    #     enable_gesture = false # laptop touchpad, 4 fingers
    #     gesture_distance = 300 # how far is the "max"
    #     gesture_positive = false
    # }
}